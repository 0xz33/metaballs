<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Metaballs and Marching Squares</title>
    <style>
      body {
        padding: 0;
        margin: 0;
      }

      canvas {
        width: 100%;
        height: 100%;
        border: 1px dotted black;
      }
      #hero {
        width: 100vw;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }
    </style>
  </head>
  <body>
    <section id="hero">
      <canvas id="metaballCanvas" width="800" height="800"></canvas>
    </section>
    <script>
      const canvas = document.getElementById("metaballCanvas");
      const ctx = canvas.getContext("2d");
      const width = canvas.width;
      const height = canvas.height;

      function getRandomFloat(min, max) {
        return Math.random() * (max - min) + min;
      }

      // Define some metaballs
      const xRange = [80, 120];
      const yRange = [80, 120];
      const rRange = [40, 60];
      const vxRange = [1, 2];
      const vyRange = [1, 2];

      const metaballs = Array(8)
        .fill()
        .map(() => ({
          x: getRandomFloat(...xRange),
          y: getRandomFloat(...yRange),
          r: getRandomFloat(...rRange),
          vx: getRandomFloat(...vxRange),
          vy: getRandomFloat(...vyRange),
        }));

      // Add more metaballs as needed
      //   const metaballs = [
      //     {
      //       x: 100,
      //       y: 100,
      //       r: 50,
      //       vx: getRandomFloat(1, 2),
      //       vy: getRandomFloat(1, 2),
      //     },
      //     { x: 300, y: 300, r: 60, vx: -1, vy: -1.2 },
      //     { x: 300, y: 300, r: 20, vx: -1, vy: -1.2 },
      //     { x: 30, y: 100, r: 10, vx: 1, vy: 1.4 },

      //     // Add more metaballs as needed
      //   ];

      function f(x, y) {
        let sum = 0;
        for (let ball of metaballs) {
          let dx = x - ball.x;
          let dy = y - ball.y;
          let distSq = dx * dx + dy * dy;
          sum += (ball.r * ball.r) / distSq;
        }
        return sum;
      }

      function updateMetaballs() {
        for (let ball of metaballs) {
          ball.x += ball.vx;
          ball.y += ball.vy;
          if (ball.x < ball.r || ball.x > width - ball.r) ball.vx = -ball.vx;
          if (ball.y < ball.r || ball.y > height - ball.r) ball.vy = -ball.vy;
        }
      }

      function draw() {
        ctx.clearRect(0, 0, width, height);

        for (let y = 0; y < height; y += 5) {
          for (let x = 0; x < width; x += 5) {
            if (f(x, y) > 1) {
              ctx.fillRect(x, y, 5, 5);
            }
          }
        }

        updateMetaballs();
        requestAnimationFrame(draw);
      }

      draw();
    </script>
  </body>
</html>
